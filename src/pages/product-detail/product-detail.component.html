

<div class="bg-gray-900 text-white min-h-screen py-16">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    @if (product(); as p) {
      <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-start">
        <!-- Product Image -->
        <div>
          <img [ngSrc]="p.image" [alt]="p.name" class="w-full rounded-lg shadow-lg object-cover" width="600" height="600" priority>
        </div>

        <!-- Product Details -->
        <div class="bg-gray-800 p-8 rounded-lg border border-gray-700">
          <h2 class="text-3xl md:text-4xl font-bold mb-4">{{ p.name }}</h2>
          
          <!-- AI Generated Description Section -->
          <div class="mb-6 min-h-[120px]">
            @switch (aiDescriptionState().status) {
              @case('loading') {
                <div class="flex items-center space-x-3 text-gray-400 animate-pulse">
                  <i class="fas fa-robot"></i>
                  <span>Sarah is crafting a description...</span>
                </div>
              }
              @case('success') {
                <p class="text-gray-300 whitespace-pre-wrap">{{ aiDescriptionState().description }}</p>
              }
              @case('error') {
                <!-- Fallback to original short description on error with a message -->
                <div class="p-3 mb-3 bg-amber-900/40 border border-amber-500/50 rounded-lg">
                  <div class="flex items-center text-amber-400">
                    <i class="fas fa-exclamation-triangle mr-3"></i>
                    <p class="text-sm">Sarah couldn't generate a detailed description at the moment. Displaying a brief overview instead.</p>
                  </div>
                </div>
                <p class="text-gray-400">{{ p.description }}</p>
              }
            }
          </div>
          
          <div class="font-bold text-cyan-400 text-3xl mb-6">Rs. {{ p.price }}</div>
          
          <div id="condition" class="flex items-center text-gray-300 mb-6">
            <i class="fas fa-check-circle text-emerald-400 mr-2"></i>
            <span>Condition: New</span>
          </div>
          
          <button (click)="onAddToCart()" class="w-full px-8 py-4 rounded-md border-none cursor-pointer font-medium bg-fuchsia-600 text-white hover:bg-fuchsia-700 transition-all duration-300 text-lg">
            <i class="fas fa-shopping-cart mr-2"></i>
            Add to Cart
          </button>
        </div>
      </div>

      <!-- Customer Reviews Section -->
      <div class="mt-20 pt-12 border-t border-gray-800">
        <h3 class="text-3xl font-bold mb-4">Customer Reviews</h3>
        
        @if (reviews().length > 0) {
          <div class="flex items-center mb-6 bg-gray-800 p-4 rounded-lg border border-gray-700">
             <div class="flex items-center space-x-1 text-amber-400 text-xl">
              @for (star of [1,2,3,4,5]; track star) {
                <i class="fa-star" [class.fa-solid]="averageRating() >= star" [class.fa-regular]="averageRating() < star - 0.5" [class.fa-star-half-stroke]="averageRating() >= star - 0.5 && averageRating() < star"></i>
              }
            </div>
            <span class="ml-3 text-lg font-bold text-white">{{ averageRating() | number:'1.1-1' }} out of 5</span>
            <span class="ml-4 text-gray-400">based on {{ reviews().length }} reviews</span>
          </div>
        }

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 mt-8">
            <div>
                <h4 class="text-2xl font-semibold mb-4">Leave a Review</h4>
                <app-review-form (reviewSubmit)="onReviewSubmit($event)"></app-review-form>
            </div>
            <div>
                <h4 class="text-2xl font-semibold mb-4">What people are saying</h4>
                <div class="max-h-[500px] overflow-y-auto pr-2">
                    <app-review-list [reviews]="reviews()"></app-review-list>
                </div>
            </div>
        </div>
      </div>


      <!-- Related Products -->
      <div class="mt-20 pt-12 border-t border-gray-800">
        <h3 class="text-3xl font-bold text-center mb-8">You Might Also Like</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
          @for (related of relatedProducts(); track related.id) {
            <app-product-card [product]="related" (addToCartEvent)="handleRelatedAddToCart($event)" />
          }
        </div>
      </div>
    } @else {
      <div class="text-center bg-gray-800 p-12 rounded-lg border border-gray-700">
        <h3 class="text-2xl font-semibold mb-4">Product Not Found</h3>
        <p class="text-gray-400 mb-6">We couldn't find the product you're looking for.</p>
        <a routerLink="/gallery" class="px-8 py-3 rounded-md border-none cursor-pointer font-medium bg-fuchsia-600 text-white hover:bg-fuchsia-700 transition-all duration-300">Back to Gallery</a>
      </div>
    }
  </div>
</div>